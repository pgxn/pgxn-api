Revision history for Perl extension PGXN::API

0.10.0  2011-04-11T23:41:16
      - Removed PGXN::API::Stats. The same data is now generated by
        PGXN::Manager 0.11.0.
      - Updated sync to properly copy the new stats files from the mirror root,
        as well as the new spec file.
      - Updated sync to update the root `index.json` only if it has changed.
        It will of course also be created on the first sync to a new doc root.
      - Changed sync to load templates from the mirror root instead of relying
        on those loaded from the doc root by PGXN::API. This is because the
        latter won't exist before we start parsing the `rsync` log file, and
        may need updating even if it does exist.

0.9.0   2011-04-06T04:18:53
      - Requests for a dist, extension, user, or tag URI ending in "/" instead
        or ".json" (as in "/tag/pair/" instead of "/tag/pair.json") now
        returns the JSON file.
      - Added PGXN::API::Stats. It's used during sync to generate stats for
        all the objects managed by the API (distributions, users, extensions,
        and tags).

0.8.0   2011-04-02T20:32:02
      - Documentation and README documents now have their white space
        normalized to single spaces before indexing. This allows highlighting
        to work better in result sets. Suggested by Marvin Humphrey.
      - The PGXN::API::Searcher object used by the router is now maintained
        across requests, rather than created a new for every call to the
        /search API. This is because PGXN::API::Searcher v0.7.1 properly
        reconnects in the event of a changed index, so we don't have to worry
        about it here.
      - Fixed the `uri` and `email` fields in the user search index so that
        they are both stored *and* indexed. They were previously just indexed,
        and so might be missing from search results.

0.7.0   2011-03-31T20:55:51
      - Added "search" URI template to the API server's `/index.json`.
      - Added full documentation.
      - The indexer now respects the `no_index` key in the meta file.
        Specifically, it will ignore any documentation files that match the
        no_index spec. They won't be indexed.
      - Changed the default `mirror_root` subdirectory from "pgxn" to
        "mirror".
      - Added query parameter validation to the `/search` API. Any invalid
        parameters now return 400.
      - Restored required index specification to the search API path, rather
        than a query parameter. So `/search` is now a 404. Use `/search/docs`
        instead. Can also use `/search/dists`, `/search/extensions`,
        `/search/users`, and `/search/tags`.
      - To be in sync with the above, the search indexes now have plural names
        rather than singular.
      - Fixed "Cannot copy directory" errors in tests when run from a
        distribution.

0.6.9   2011-03-29T04:43:53
      - Fixed option processing in `pgxn_api.psgi` so that it deals only with
        the options we care about. Otherwise it fails to start when running
        under Starman.

0.6.8   2011-03-29T04:18:30
      - Added X-PGXN-API-Version header to all HTTP responses.
      - Added required `errors_to` and `errors_from` parameters to the router.
      - Added required `errors_to` and `errors_from` options to
        `pgxn_api.psgi`, as well as the `doc_root` option.
      - Added the `--root` option to `pgxn_api_sync`.

0.6.7   2011-03-29T02:18:01
      - Moved the doc path in the extension JSON file under the release status
        key.

0.6.6   2011-03-29T01:13:48
      - Changed `{+path}` in the doc URI template to `{+doc}`, since that
        will be more meaningful in other contexts.
      - Added the `doc` key to the `provides` hashes in the distribution
        metadata. It contains the doc path (as used by the doc URI template)
        to the doc with the same base name as the provided extension.
      - Added the `doc` key to the extension search index, so it's easy to
        link to the documentation page from extension search results.

0.6.5   2011-03-28T03:57:52
      - The search API no longer fails when only "q" query parameter is
        passed.
      - Added a 500 error handler that sends an email on error.

0.6.4   2011-03-28T03:07:13
      - Updated for PGXN::API::Searcher v0.6.1. 
      - Now only one search URL, `/search`. The index is specified via the
        `in` query parameter.

0.6.3   2011-03-28T02:08:01
      - Updated for new URI template names in PGXN::Manager v0.10.4.
      - Updated tests for new default metadata URI template paths.

0.6.2   2011-03-26T05:29:36
      - Search requests go to /search instead of /by. The latter is used for
        metadata files.
      - Fixed another "Use of uninitialized value in subroutine entry" warning
        from the indexer.

0.6.1   2011-03-26T04:12:42
      - Fixed error in indexer for distributions with no tags.
      - Fixed "Use of uninitialized value in subroutine entry" warnings from
        the full text indexer in PGXN::API::Indexer.
      - Fixed user name in distribution full text index so that it's not the
        same name for all users.

0.6.0   2011-03-26T03:14:12
      - The /src directory is now served with Plack::App::Directory, so that a
        listing of the files in a directory will be presented. Elsewhere,
        directory requests return a 404.
      - Added full-text search indexing. Requests go to /by.

0.5.5   2011-03-17T23:07:43
      - Changed doc JSON to have a hash for each value: a title and an
        abstract (if there is one).

0.5.4   2011-03-17T00:08:30
      - Updated to work with new default URI templates deployed in
        PGXN::Manager 0.10.2.

0.5.3  2011-03-16T03:16:27
      - Changed doc template to use `{+path}` instead of `{doc}`, so that
        slashes will not be encoded. This isn't strictly-speaking supported by
        URI::Template yet, so for now we set the variable as `+path` and
        prevent URI::Escape from escaping slashes.

0.5.2   2011-03-15T22:23:56
      - HTML documents are now properly written out at UTF-8, instead of as
        raw bytes.
      - The doc parser no longer autovivifies doc file names into the
        "provides" has of the version metadata file.

0.5.1   2011-03-15T21:44:07
      - The sync code now updates the mirror meta after `rsync`ing but before
        doing anything else. It was fetching a template first, and this caused
        errors on the first sync because the `index.json` had not yet been
        copied to the document root.

0.5.0   2011-03-15T21:24:59
      - The URI templates are now read from the doc root rather than the
        mirror root, so that the API-specific templates stored there will be
        visible to the app.
      - Added documentation parsing. Docs are read by Text::Markup and
        converted to HTML. The HTML is cleaned up, unwanted stuff removed, and
        a table of contents added. They are then written to a file represented
        by the new "doc" URI template. They are also listed in the versioned
        distribution metadata, suitable for for formatting into a URI via the
        template. README files are included in this formatting treatment.

0.4.1   2011-03-11T23:42:38
      - Fixed a bug introduced in 0.4.0 where the /by/user and /by/tag files
        were overwriting release data from other distributions, thereby
        removing their abstracts. We now update the release data only for the
        currently-processing distribution.

0.4.0   2011-03-11T23:23:12
      - Added the "special_files" key to the distribution metadata file. It
        includes paths to `README`, `META.json`, `Changes`, `Makefile`, and
        other special files in the distribution.
      - Moved unzipped source directories under a subdirectory named for the
        distribution. That is, rather than `/src/pair-0.1.1/`, we now have
        `/src/pair/pair-0.1.1/`.
      - Make sure that the `/by/dist` file has the latest *stable* version
        listed as the version. Only make it a testing version if there is no
        stable version, and an unstabe version only if there is no stable or
        testing version.
      - Fixed bugs in release data merging in the `/by/user` and `/by/tag`
        files. The old code had relied too much on what was in the
        distribution. Since the only additional data point over the mirrored
        original is an abstract, we can just rely on the mirror data to be
        correct and add the abstract. This simplifies the code quite a bit, in
        fact.

0.3.2   2011-03-10T21:53:17
      - Updated to work with PGXN::Manager 0.10.0 output. In particular,
        "owners" are now known as "users" and "release_date" is now known as
        "date". The relevant methods and data have been chagned to reflect
        this change.

0.3.1 2011-03-10T00:28:36
      - Updated to work with PGXN::Manager 0.9.1 output.

0.3.0 2011-03-09T22:18:16
      - Updated to work with PGXN::Manager 0.9.0 output.

0.2.0   2011-03-03T01:09:42
      - No longer serve directory indexes.
      - Added tests for the router.
      - Serve distribution files with content-type application/zip.
      - Added `var/index.html`, placeholder for a root-level HTML file.

0.1.0   2011-03-02 23:58:41
      - Initial version.
      - Syncs to mirror.
      - Merges metadata to API doc root.
      - Has PSGI to serve static files from the doc root.
